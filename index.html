<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… DIAMOND PRO - ØªØ­Ù„ÙŠÙ„ OTC</title>
    <!-- Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial"></script>
    <script src="https://cdn.jsdelivr.net/npm/technicalindicators"></script>
    <!-- Ø£Ù†Ù…Ø§Ø· Ø§Ù„ØªØµÙ…ÙŠÙ… -->
    <style>
        body { font-family: Arial, sans-serif; background: #0f172a; color: #fff; text-align: center; }
        .container { max-width: 900px; margin: auto; padding: 20px; }
        .chart-container { width: 100%; height: 400px; background: #1e293b; padding: 15px; border-radius: 10px; }
        .signal-box { margin-top: 20px; padding: 15px; font-size: 18px; font-weight: bold; border-radius: 8px; }
        .buy { background: #10b981; }
        .sell { background: #ef4444; }
    </style>
</head>
<body>

<div class="container">
    <h1>ØªØ­Ù„ÙŠÙ„ OTC - DIAMOND PRO</h1>
    <div id="signalBox" class="signal-box">Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³ÙˆÙ‚...</div>
    <div class="chart-container">
        <canvas id="candleChart"></canvas>
    </div>
</div>

<script>
    async function fetchMarketData() {
        try {
            const response = await fetch('https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1m&limit=30');
            const data = await response.json();
            return data.map(candle => ({
                time: new Date(candle[0]),
                open: parseFloat(candle[1]),
                high: parseFloat(candle[2]),
                low: parseFloat(candle[3]),
                close: parseFloat(candle[4])
            }));
        } catch (error) {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);
            return [];
        }
    }

    function analyzeMarket(candles) {
        const closingPrices = candles.map(c => c.close);
        const rsiValues = technicalindicators.RSI.calculate({ period: 14, values: closingPrices });
        const macdValues = technicalindicators.MACD.calculate({
            values: closingPrices,
            fastPeriod: 12,
            slowPeriod: 26,
            signalPeriod: 9,
            SimpleMAOscillator: false,
            SimpleMASignal: false
        });
        const stochValues = technicalindicators.Stochastic.calculate({
            high: candles.map(c => c.high),
            low: candles.map(c => c.low),
            close: closingPrices,
            period: 14,
            signalPeriod: 3
        });

        const lastRSI = rsiValues[rsiValues.length - 1];
        const lastMACD = macdValues[macdValues.length - 1];
        const lastStochastic = stochValues[stochValues.length - 1];

        let signalText = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø§Ø±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹", signalClass = "";

        if (lastRSI < 30 && lastMACD.MACD > lastMACD.signal && lastStochastic.k < 20) {
            signalText = "ðŸ“ˆ Ø¥Ø´Ø§Ø±Ø© Ø´Ø±Ø§Ø¡ Ù…Ø¤ÙƒØ¯Ø©!";
            signalClass = "buy";
        } else if (lastRSI > 70 && lastMACD.MACD < lastMACD.signal && lastStochastic.k > 80) {
            signalText = "ðŸ“‰ Ø¥Ø´Ø§Ø±Ø© Ø¨ÙŠØ¹ Ù…Ø¤ÙƒØ¯Ø©!";
            signalClass = "sell";
        }

        const signalBox = document.getElementById("signalBox");
        signalBox.textContent = signalText;
        signalBox.className = `signal-box ${signalClass}`;
    }

    function drawChart(candles) {
        const ctx = document.getElementById("candleChart").getContext("2d");
        if (window.candleChart) {
            window.candleChart.destroy();
        }
        window.candleChart = new Chart(ctx, {
            type: "candlestick",
            data: {
                datasets: [{
                    label: "BTC/USDT",
                    data: candles.map(c => ({ x: c.time, o: c.open, h: c.high, l: c.low, c: c.close })),
                    borderColor: "white",
                    color: { up: "#10b981", down: "#ef4444", unchanged: "#94a3b8" }
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { type: "time", time: { unit: "minute" } },
                    y: { ticks: { callback: v => v.toFixed(2) } }
                }
            }
        });
    }

    async function runAnalysis() {
        const marketData = await fetchMarketData();
        if (marketData.length > 0) {
            drawChart(marketData);
            analyzeMarket(marketData);
        }
    }

    setInterval(runAnalysis, 60000);
    window.onload = runAnalysis;
</script>

</body>
</html>
